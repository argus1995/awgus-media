---
import MainLayout from "../../layouts/MainLayout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import { Icon } from "astro-icon/components";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");

  // 1. Ambil semua kategori unik dari semua artikel
  const uniqueCategories = [
    ...new Set(allPosts.map((post) => post.data.category)),
  ];

  // 2. Buat halaman untuk setiap kategori
  return uniqueCategories.map((category) => {
    // Filter artikel yang hanya memiliki kategori ini
    const filteredPosts = allPosts.filter(
      (post) => post.data.category === category
    );

    return {
      params: { category }, // Ini akan mengisi URL /[category]/
      props: { posts: filteredPosts }, // Kirim artikel yang sudah difilter ke HTML
    };
  });
}

const { category } = Astro.params;
const { posts } = Astro.props;
---

<MainLayout>
  <Navbar />

  <section class="max-w-4xl mx-auto py-16 px-6">
    <!-- Judul -->
    <h1 class="text-3xl font-bold mb-4">{category}</h1>

    <!-- Deskripsi -->
    <p class="mb-10 text-gray-600">
      Membahas jaringan, server, keamanan, dan sistem IT sebagai fondasi
      operasional yang stabil dan efisien.
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-20">
      {
        posts.map((post) => (
          <div class="bg-white shadow rounded-lg p-5 hover:shadow-lg transition">
            <div class="mb-3 flex justify-center">
              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600 border-2 border-green-200">
                {/* <Icon name={article.icon} class="w-6 h-6" /> */}
              </div>
            </div>
            <h4 class="text-md mb-2 text-center">{post.data.title}</h4>
            {/* <a
                href={article.href}
                class="text-green-600 font-small hover:underline flex justify-center"
              >
                Baca â†’
              </a> */}
            <a
              href={`/${post.data.category}/${post.slug}`}
              class="text-green-600 font-small hover:underline flex justify-center"
            >
              Baca &#8594;
            </a>
            {posts.length === 0 && <p>Belum ada artikel di kategori ini.</p>}
          </div>
        ))
      }
    </div>

    <!-- Back -->
    <a href="/" class="inline-block mt-10 text-green-600 hover:underline">
      &#8592; Kembali ke Beranda
    </a>
  </section>

  <Footer />
</MainLayout>
