---
import MainLayout from "../../layouts/MainLayout.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";
import { categories } from "../../content/categories";

/**
 * Ambil tipe kategori dari object categories
 */
type CategoryKey = keyof typeof categories;

/**
 * Generate SEMUA kategori walaupun belum ada artikel
 */
export async function getStaticPaths() {
  const allPosts = await getCollection("posts");

  return (Object.keys(categories) as CategoryKey[]).map((category) => {
    const filteredPosts = allPosts.filter(
      (post) => post.data.category === category
    );

    return {
      params: { category },
      props: { posts: filteredPosts },
    };
  });
}

/**
 * Params & Props
 */
const { category } = Astro.params as { category: CategoryKey };
const { posts } = Astro.props as {
  posts: Awaited<ReturnType<typeof getCollection>>;
};

/**
 * Data kategori (100% type-safe)
 */
const categoryData = categories[category];
---

<MainLayout>
  <section class="max-w-4xl mx-auto py-16 px-6">
    <!-- Judul -->
    <h1 class="text-3xl font-bold mb-4">
      {categoryData.title}
    </h1>

    <!-- Deskripsi -->
    <p class="mb-10 text-gray-600">
      {categoryData.description}
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-20">
      <!-- Empty state -->
      {
        posts.length === 0 && (
          <div class="bg-white shadow rounded-lg p-5 hover:shadow-lg transition">
            <div class="mb-3 flex justify-center">
              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600 border-2 border-green-200">
                <Icon name={categoryData.icon} class="w-6 h-6" />
              </div>
            </div>

            <h4 class="text-md mb-2 text-center">
              Belum ada artikel di kategori ini.
            </h4>

            {/* <a
              href={`/${post.data.category}/${post.slug}`}
              class="text-green-600 text-sm hover:underline flex justify-center"
            >
              Baca →
            </a> */}
          </div>
        )
      }

      <!-- List post -->
      {
        posts.map((post) => (
          <div class="bg-white shadow rounded-lg p-5 hover:shadow-lg transition">
            <div class="mb-3 flex justify-center">
              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600 border-2 border-green-200">
                <Icon name={categoryData.icon} class="w-6 h-6" />
              </div>
            </div>

            <h4 class="text-md mb-2 text-center">{post.data.title}</h4>

            <a
              href={`/${post.slug}`}
              class="text-green-600 text-sm hover:underline flex justify-center"
            >
              Baca →
            </a>
          </div>
        ))
      }
    </div>

    <a href="/" class="inline-block mt-10 text-green-600 hover:underline">
      ← Kembali ke Beranda
    </a>
  </section>
</MainLayout>
